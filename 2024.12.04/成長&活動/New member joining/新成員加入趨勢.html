<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Shop 新成員加入統計</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <style>
        .reset-zoom {
            margin: 10px;
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .reset-zoom:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chart-container">
            <button class="reset-zoom" onclick="resetZoom()">重設縮放</button>
            <canvas id="joinTrendChart"></canvas>
        </div>

        <div class="stats-container">
            <div class="stat-box">
                <h3>總加入人數</h3>
                <div id="totalJoins" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <h3>邀請加入</h3>
                <div id="inviteJoins" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <h3>自然發現</h3>
                <div id="discoveryJoins" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <h3>其他管道</h3>
                <div id="otherJoins" class="stat-value">0</div>
            </div>
        </div>
    </div>
    <script>
        const fullData = [
            ["2023-08-06T00:00:00+00:00",0,4,1,0,0,0,1,6],
            ["2024-08-07T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-08-08T00:00:00+00:00",1,3,0,0,0,0,0,4],
            ["2024-08-09T00:00:00+00:00",1,1,0,0,0,0,1,3],
            ["2024-08-10T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-08-11T00:00:00+00:00",1,3,0,0,0,0,0,4],
            ["2024-08-12T00:00:00+00:00",1,6,0,0,0,0,0,7],
            ["2024-08-13T00:00:00+00:00",1,1,0,0,0,0,1,3],
            ["2024-08-14T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-08-15T00:00:00+00:00",1,3,0,0,0,0,2,6],
            ["2024-08-16T00:00:00+00:00",2,5,0,0,0,0,0,7],
            ["2024-08-17T00:00:00+00:00",0,2,1,0,0,0,0,3],
            ["2024-08-18T00:00:00+00:00",0,0,2,0,0,0,0,2],
            ["2024-08-19T00:00:00+00:00",1,4,0,0,0,0,0,5],
            ["2024-08-20T00:00:00+00:00",1,0,0,0,0,0,0,1],
            ["2024-08-21T00:00:00+00:00",1,6,0,0,0,0,0,7],
            ["2024-08-22T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-08-23T00:00:00+00:00",2,30,1,0,0,0,0,33],
            ["2024-08-24T00:00:00+00:00",0,18,1,0,0,0,0,19],
            ["2024-08-25T00:00:00+00:00",1,19,3,0,0,0,1,24],
            ["2024-08-26T00:00:00+00:00",0,7,0,0,0,0,2,9],
            ["2024-08-27T00:00:00+00:00",0,6,2,0,0,0,0,8],
            ["2024-08-28T00:00:00+00:00",0,5,1,0,0,0,0,6],
            ["2024-08-29T00:00:00+00:00",0,8,0,0,0,0,0,8],
            ["2024-08-30T00:00:00+00:00",0,6,2,0,0,0,2,10],
            ["2024-08-31T00:00:00+00:00",0,4,1,0,0,0,0,5],
            ["2024-09-01T00:00:00+00:00",1,7,0,0,0,0,1,9],
            ["2024-09-02T00:00:00+00:00",2,4,2,0,0,0,0,8],
            ["2024-09-03T00:00:00+00:00",0,1,1,0,0,0,0,2],
            ["2024-09-04T00:00:00+00:00",0,3,0,0,0,0,0,3],
            ["2024-09-05T00:00:00+00:00",1,2,2,0,0,0,0,5],
            ["2024-09-06T00:00:00+00:00",0,10,1,0,0,0,0,11],
            ["2024-09-07T00:00:00+00:00",3,7,2,0,0,0,0,12],
            ["2024-09-08T00:00:00+00:00",0,8,0,0,0,0,0,8],
            ["2024-09-09T00:00:00+00:00",0,15,0,0,0,0,0,15],
            ["2024-09-10T00:00:00+00:00",1,27,0,0,0,0,1,29],
            ["2024-09-11T00:00:00+00:00",1,8,1,0,0,0,1,11],
            ["2024-09-12T00:00:00+00:00",1,12,6,0,0,0,2,21],
            ["2024-09-13T00:00:00+00:00",2,2,1,0,0,0,0,5],
            ["2024-09-14T00:00:00+00:00",1,4,0,0,0,0,1,6],
            ["2024-09-15T00:00:00+00:00",0,1,1,0,0,0,1,3],
            ["2024-09-16T00:00:00+00:00",1,2,1,0,0,0,0,4],
            ["2024-09-17T00:00:00+00:00",0,2,1,0,0,0,0,3],
            ["2024-09-18T00:00:00+00:00",2,7,0,0,0,0,1,10],
            ["2024-09-19T00:00:00+00:00",1,2,0,0,0,0,0,3],
            ["2024-09-20T00:00:00+00:00",0,7,1,0,0,0,0,8],
            ["2024-09-21T00:00:00+00:00",1,18,0,0,0,0,0,19],
            ["2024-09-22T00:00:00+00:00",0,7,1,0,0,0,0,8],
            ["2024-09-23T00:00:00+00:00",0,9,0,0,0,0,0,9],
            ["2024-09-24T00:00:00+00:00",0,5,2,0,0,0,0,7],
            ["2024-09-25T00:00:00+00:00",0,15,3,0,0,0,0,18],
            ["2024-09-26T00:00:00+00:00",1,3,0,0,0,0,0,4],
            ["2024-09-27T00:00:00+00:00",0,3,2,0,0,0,0,5],
            ["2024-09-28T00:00:00+00:00",0,1,1,0,0,0,0,2],
            ["2024-09-29T00:00:00+00:00",0,2,1,0,0,0,0,3],
            ["2024-09-30T00:00:00+00:00",0,19,0,0,0,0,0,19],
            ["2024-10-01T00:00:00+00:00",0,7,2,0,0,0,0,9],
            ["2024-10-02T00:00:00+00:00",0,74,3,0,0,0,1,78],
            ["2024-10-03T00:00:00+00:00",0,11,2,0,0,0,0,13],
            ["2024-10-04T00:00:00+00:00",1,9,2,0,0,0,0,12],
            ["2024-10-05T00:00:00+00:00",0,3,1,0,0,0,0,4],
            ["2024-10-06T00:00:00+00:00",1,11,0,0,0,0,1,13],
            ["2024-10-07T00:00:00+00:00",1,2,3,0,0,0,1,7],
            ["2024-10-08T00:00:00+00:00",1,2,0,0,0,0,0,3],
            ["2024-10-09T00:00:00+00:00",2,2,1,0,0,0,0,5],
            ["2024-10-10T00:00:00+00:00",1,2,0,0,0,0,1,4],
            ["2024-10-11T00:00:00+00:00",1,3,0,0,0,0,0,4],
            ["2024-10-12T00:00:00+00:00",1,7,0,0,0,0,2,10],
            ["2024-10-13T00:00:00+00:00",0,0,0,0,0,0,0,0],
            ["2024-10-14T00:00:00+00:00",0,3,1,0,0,0,1,5],
            ["2024-10-15T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-10-16T00:00:00+00:00",1,2,3,0,0,0,0,6],
            ["2024-10-17T00:00:00+00:00",1,0,0,0,0,0,0,1],
            ["2024-10-18T00:00:00+00:00",3,1,0,0,0,0,0,4],
            ["2024-10-19T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-10-20T00:00:00+00:00",0,3,1,0,0,0,0,4],
            ["2024-10-21T00:00:00+00:00",1,8,0,0,0,0,0,9],
            ["2024-10-22T00:00:00+00:00",0,3,1,0,0,0,0,4],
            ["2024-10-23T00:00:00+00:00",2,1,1,0,0,0,1,5],
            ["2024-10-24T00:00:00+00:00",1,1,0,0,0,0,0,2],
            ["2024-10-25T00:00:00+00:00",0,1,0,0,0,0,1,2],
            ["2024-10-26T00:00:00+00:00",1,0,0,0,0,0,0,1],
            ["2024-10-27T00:00:00+00:00",1,2,1,0,0,0,0,4],
            ["2024-10-28T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-10-29T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-10-30T00:00:00+00:00",1,1,0,0,0,0,0,2],
            ["2024-10-31T00:00:00+00:00",0,3,0,0,0,0,1,4],
            ["2024-11-01T00:00:00+00:00",1,2,0,0,0,0,1,4],
            ["2024-11-02T00:00:00+00:00",1,0,1,0,0,0,0,2],
            ["2024-11-03T00:00:00+00:00",1,0,1,0,0,0,0,2],
            ["2024-11-04T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-11-05T00:00:00+00:00",0,2,0,0,0,0,1,3],
            ["2024-11-06T00:00:00+00:00",0,2,0,0,0,0,0,2],
            ["2024-11-07T00:00:00+00:00",0,0,0,0,0,0,0,0],
            ["2024-11-08T00:00:00+00:00",1,3,0,0,0,0,0,4],
            ["2024-11-09T00:00:00+00:00",0,3,1,0,0,0,0,4],
            ["2024-11-10T00:00:00+00:00",0,0,0,0,0,0,0,0],
            ["2024-11-11T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-11-12T00:00:00+00:00",0,1,0,0,0,0,1,2],
            ["2024-11-13T00:00:00+00:00",0,0,1,0,0,0,0,1],
            ["2024-11-14T00:00:00+00:00",0,2,0,0,0,0,0,2],
            ["2024-11-15T00:00:00+00:00",1,4,0,0,0,0,1,6],
            ["2024-11-16T00:00:00+00:00",1,7,0,0,0,0,0,8],
            ["2024-11-17T00:00:00+00:00",1,4,2,0,0,0,1,8],
            ["2024-11-18T00:00:00+00:00",0,1,0,0,0,0,0,1],
            ["2024-11-19T00:00:00+00:00",0,3,0,0,0,0,1,4],
            ["2024-11-20T00:00:00+00:00",0,2,1,0,0,0,1,4],
            ["2024-11-21T00:00:00+00:00",0,0,0,0,0,0,1,1],
            ["2024-11-22T00:00:00+00:00",1,2,1,0,0,0,0,4],
            ["2024-11-23T00:00:00+00:00",1,0,0,0,0,0,0,1],
            ["2024-11-24T00:00:00+00:00",0,2,0,0,0,0,0,2],
            ["2024-11-25T00:00:00+00:00",0,1,1,0,0,0,0,2],
            ["2024-11-26T00:00:00+00:00",0,0,1,0,0,0,0,1],
            ["2024-11-27T00:00:00+00:00",1,4,0,0,0,0,0,5],
            ["2024-11-28T00:00:00+00:00",1,0,0,0,0,0,1,2],
            ["2024-11-29T00:00:00+00:00",0,2,0,0,0,0,0,2],
            ["2024-11-30T00:00:00+00:00",0,2,0,0,0,0,3,5],
            ["2024-12-01T00:00:00+00:00",0,1,1,0,0,0,1,3],
            
        ];
        const chartContainer = document.querySelector('.chart-container');
        chartContainer.style.height = '500px';  // Increase chart height to 500px
        chartContainer.style.width = '100%';    // Make chart width responsive
        function initChart() {
            try {
                const data = fullData.map(row => ({
                    date: new Date(row[0]),
                    discovery: parseInt(row[1]) || 0,
                    invites: parseInt(row[2]) || 0,
                    others: parseInt(row[7]) || 0,
                    total: parseInt(row[8]) || 0
                }));

                const totals = data.reduce((acc, curr) => ({
                    total: acc.total + curr.total,
                    invites: acc.invites + curr.invites,
                    discovery: acc.discovery + curr.discovery,
                    others: acc.others + curr.others
                }), { total: 0, invites: 0, discovery: 0, others: 0 });

                updateStats(totals);
                createChart(data);
            } catch (error) {
                console.error('Error:', error);
                document.querySelector('.chart-container').innerHTML = 
                    `<p style="color: red;">Error loading chart: ${error.message}</p>`;
            }
        }

        function updateStats(totals) {
            document.getElementById('totalJoins').textContent = totals.total;
            document.getElementById('inviteJoins').textContent = totals.invites;
            document.getElementById('discoveryJoins').textContent = totals.discovery;
            document.getElementById('otherJoins').textContent = totals.others;
        }

        function createChart(data) {
            const ctx = document.getElementById('joinTrendChart').getContext('2d');
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => {
                        const date = d.date;
                        return `${date.getMonth() + 1}/${date.getDate()}`; // 簡化日期顯示
                    }),
                    datasets: [
                        {
                            label: '總加入人數',
                            data: data.map(d => d.total),
                            borderColor: 'rgb(75, 192, 192)',
                            tension: 0.1,
                            fill: false
                        },
                        {
                            label: '邀請加入',
                            data: data.map(d => d.invites),
                            borderColor: 'rgb(255, 99, 132)',
                            tension: 0.1,
                            fill: false
                        },
                        {
                            label: '自然發現',
                            data: data.map(d => d.discovery),
                            borderColor: 'rgb(54, 162, 235)',
                            tension: 0.1,
                            fill: false
                        },
                        {
                            label: '其他管道',
                            data: data.map(d => d.others),
                            borderColor: 'rgb(153, 102, 255)',
                            tension: 0.1,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: '每日加入人數',
                                font: { size: 14 }
                            }
                        },
                        x: {
                            title: { 
                                display: true, 
                                text: '日期 (8/6-12/1)',
                                font: { size: 14 }
                            }
                        }
                    },
                    plugins: {
                        zoom: {
                            pan: {
                                enabled: true,
                                mode: 'x',
                                modifierKey: 'ctrl',
                            },
                            zoom: {
                                wheel: {
                                    enabled: true,
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'x',
                            }
                        },
                        legend: { position: 'top' },
                        title: {
                            display: true,
                            text: 'Coffee Shop 新成員加入趨勢分析 (2023/8/6-12/1)',
                            font: { size: 16, weight: 'bold' }
                        }
                    }
                }
            });
        }

        function resetZoom() {
            if (window.myChart) {
                window.myChart.resetZoom();
            }
        }

        window.addEventListener('load', initChart);
    </script>
</body>
</html>