<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新會員下週留存分析</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f5f5f5;
        }
        .chart-container {
            margin: 20px 0;
            height: 400px;
        }
        .description {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            line-height: 1.6;
        }
        .tip {
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>新會員下週留存分析</h1>
        
        <div class="description">
            <h2>新會員下週留存率如何？</h2>
            <p>留存率用於衡量新會員在首次加入後是否持續活躍於伺服器中。要提高這個數字，請專注於改善會員啟動率（參見上圖）並讓您的社群更加活躍。</p>
            <p>如何解讀數據：如果4月1日有10位新會員加入，而週留存率為20%，這表示在這10位新成員中，有2位在下週（4月8日至4月15日）期間重新訪問了伺服器。因此，留存率曲線總是會落後於當前日期兩週。</p>
            <p class="tip">提示：如果圖表看起來波動很大，可能是因為每日新增會員數量不足。試著將時間間隔改為每週或每月。</p>
        </div>

        <div class="chart-container">
            <canvas id="retentionChart"></canvas>
        </div>

        <table id="dataTable">
            <thead>
                <tr>
                    <th>日期</th>
                    <th>新會員數</th>
                    <th>留存率 (%)</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <script>
        // 數據
        const data = `day_pt\tnew_members\tpct_retained\tinterval_start_timestamp
2024-08-06T00:00:00+00:00\t6\t66.66666667\t2024-08-06T00:00:00+00:00
2024-08-07T00:00:00+00:00\t1\t\t2024-08-07T00:00:00+00:00
2024-08-08T00:00:00+00:00\t4\t75\t2024-08-08T00:00:00+00:00
2024-08-09T00:00:00+00:00\t3\t33.33333333\t2024-08-09T00:00:00+00:00
2024-08-10T00:00:00+00:00\t1\t100\t2024-08-10T00:00:00+00:00
2024-08-11T00:00:00+00:00\t4\t50\t2024-08-11T00:00:00+00:00
2024-08-12T00:00:00+00:00\t7\t28.57142857\t2024-08-12T00:00:00+00:00
2024-08-13T00:00:00+00:00\t3\t100\t2024-08-13T00:00:00+00:00
2024-08-14T00:00:00+00:00\t1\t100\t2024-08-14T00:00:00+00:00
2024-08-15T00:00:00+00:00\t6\t66.66666667\t2024-08-15T00:00:00+00:00
2024-08-16T00:00:00+00:00\t7\t71.42857143\t2024-08-16T00:00:00+00:00
2024-08-17T00:00:00+00:00\t3\t66.66666667\t2024-08-17T00:00:00+00:00
2024-08-18T00:00:00+00:00\t2\t100\t2024-08-18T00:00:00+00:00
2024-08-19T00:00:00+00:00\t5\t80\t2024-08-19T00:00:00+00:00
2024-08-20T00:00:00+00:00\t1\t100\t2024-08-20T00:00:00+00:00
2024-08-21T00:00:00+00:00\t7\t85.71428571\t2024-08-21T00:00:00+00:00
2024-08-22T00:00:00+00:00\t1\t\t2024-08-22T00:00:00+00:00
2024-08-23T00:00:00+00:00\t33\t60.60606061\t2024-08-23T00:00:00+00:00
2024-08-24T00:00:00+00:00\t19\t68.42105263\t2024-08-24T00:00:00+00:00
2024-08-25T00:00:00+00:00\t24\t58.33333333\t2024-08-25T00:00:00+00:00
2024-08-26T00:00:00+00:00\t9\t55.55555556\t2024-08-26T00:00:00+00:00
2024-08-27T00:00:00+00:00\t8\t62.5\t2024-08-27T00:00:00+00:00
2024-08-28T00:00:00+00:00\t6\t16.66666667\t2024-08-28T00:00:00+00:00
2024-08-29T00:00:00+00:00\t8\t87.5\t2024-08-29T00:00:00+00:00
2024-08-30T00:00:00+00:00\t10\t60\t2024-08-30T00:00:00+00:00
2024-08-31T00:00:00+00:00\t5\t60\t2024-08-31T00:00:00+00:00
2024-09-01T00:00:00+00:00\t9\t44.44444444\t2024-09-01T00:00:00+00:00
2024-09-02T00:00:00+00:00\t8\t50\t2024-09-02T00:00:00+00:00
2024-09-03T00:00:00+00:00\t2\t100\t2024-09-03T00:00:00+00:00
2024-09-04T00:00:00+00:00\t3\t66.66666667\t2024-09-04T00:00:00+00:00
2024-09-05T00:00:00+00:00\t5\t40\t2024-09-05T00:00:00+00:00
2024-09-06T00:00:00+00:00\t11\t63.63636364\t2024-09-06T00:00:00+00:00
2024-09-07T00:00:00+00:00\t12\t58.33333333\t2024-09-07T00:00:00+00:00
2024-09-08T00:00:00+00:00\t8\t75\t2024-09-08T00:00:00+00:00
2024-09-09T00:00:00+00:00\t15\t80\t2024-09-09T00:00:00+00:00
2024-09-10T00:00:00+00:00\t29\t65.51724138\t2024-09-10T00:00:00+00:00
2024-09-11T00:00:00+00:00\t11\t54.54545455\t2024-09-11T00:00:00+00:00
2024-09-12T00:00:00+00:00\t21\t57.14285714\t2024-09-12T00:00:00+00:00
2024-09-13T00:00:00+00:00\t5\t80\t2024-09-13T00:00:00+00:00
2024-09-14T00:00:00+00:00\t6\t83.33333333\t2024-09-14T00:00:00+00:00
2024-09-15T00:00:00+00:00\t3\t33.33333333\t2024-09-15T00:00:00+00:00
2024-09-16T00:00:00+00:00\t4\t75\t2024-09-16T00:00:00+00:00
2024-09-17T00:00:00+00:00\t3\t66.66666667\t2024-09-17T00:00:00+00:00
2024-09-18T00:00:00+00:00\t10\t80\t2024-09-18T00:00:00+00:00
2024-09-19T00:00:00+00:00\t3\t33.33333333\t2024-09-19T00:00:00+00:00
2024-09-20T00:00:00+00:00\t8\t50\t2024-09-20T00:00:00+00:00
2024-09-21T00:00:00+00:00\t19\t73.68421053\t2024-09-21T00:00:00+00:00
2024-09-22T00:00:00+00:00\t8\t75\t2024-09-22T00:00:00+00:00
2024-09-23T00:00:00+00:00\t9\t55.55555556\t2024-09-23T00:00:00+00:00
2024-09-24T00:00:00+00:00\t7\t71.42857143\t2024-09-24T00:00:00+00:00
2024-09-25T00:00:00+00:00\t18\t61.11111111\t2024-09-25T00:00:00+00:00
2024-09-26T00:00:00+00:00\t4\t50\t2024-09-26T00:00:00+00:00
2024-09-27T00:00:00+00:00\t5\t40\t2024-09-27T00:00:00+00:00
2024-09-28T00:00:00+00:00\t2\t\t2024-09-28T00:00:00+00:00
2024-09-29T00:00:00+00:00\t3\t33.33333333\t2024-09-29T00:00:00+00:00
2024-09-30T00:00:00+00:00\t19\t63.15789474\t2024-09-30T00:00:00+00:00
2024-10-01T00:00:00+00:00\t9\t55.55555556\t2024-10-01T00:00:00+00:00
2024-10-02T00:00:00+00:00\t78\t58.97435897\t2024-10-02T00:00:00+00:00
2024-10-03T00:00:00+00:00\t13\t30.76923077\t2024-10-03T00:00:00+00:00
2024-10-04T00:00:00+00:00\t12\t33.33333333\t2024-10-04T00:00:00+00:00
2024-10-05T00:00:00+00:00\t4\t100\t2024-10-05T00:00:00+00:00
2024-10-06T00:00:00+00:00\t13\t61.53846154\t2024-10-06T00:00:00+00:00
2024-10-07T00:00:00+00:00\t7\t71.42857143\t2024-10-07T00:00:00+00:00
2024-10-08T00:00:00+00:00\t3\t66.66666667\t2024-10-08T00:00:00+00:00
2024-10-09T00:00:00+00:00\t5\t60\t2024-10-09T00:00:00+00:00
2024-10-10T00:00:00+00:00\t4\t\t2024-10-10T00:00:00+00:00
2024-10-11T00:00:00+00:00\t4\t100\t2024-10-11T00:00:00+00:00
2024-10-12T00:00:00+00:00\t10\t40\t2024-10-12T00:00:00+00:00
2024-10-13T00:00:00+00:00\t0\t\t2024-10-13T00:00:00+00:00
2024-10-14T00:00:00+00:00\t5\t40\t2024-10-14T00:00:00+00:00
2024-10-15T00:00:00+00:00\t1\t\t2024-10-15T00:00:00+00:00
2024-10-16T00:00:00+00:00\t6\t83.33333333\t2024-10-16T00:00:00+00:00
2024-10-17T00:00:00+00:00\t1\t100\t2024-10-17T00:00:00+00:00
2024-10-18T00:00:00+00:00\t4\t50\t2024-10-18T00:00:00+00:00
2024-10-19T00:00:00+00:00\t1\t100\t2024-10-19T00:00:00+00:00
2024-10-20T00:00:00+00:00\t4\t25\t2024-10-20T00:00:00+00:00
2024-10-21T00:00:00+00:00\t9\t22.22222222\t2024-10-21T00:00:00+00:00
2024-10-22T00:00:00+00:00\t4\t100\t2024-10-22T00:00:00+00:00
2024-10-23T00:00:00+00:00\t5\t20\t2024-10-23T00:00:00+00:00
2024-10-24T00:00:00+00:00\t2\t50\t2024-10-24T00:00:00+00:00
2024-10-25T00:00:00+00:00\t2\t\t2024-10-25T00:00:00+00:00
2024-10-26T00:00:00+00:00\t1\t\t2024-10-26T00:00:00+00:00
2024-10-27T00:00:00+00:00\t4\t50\t2024-10-27T00:00:00+00:00
2024-10-28T00:00:00+00:00\t1\t100\t2024-10-28T00:00:00+00:00
2024-10-29T00:00:00+00:00\t1\t\t2024-10-29T00:00:00+00:00
2024-10-30T00:00:00+00:00\t2\t50\t2024-10-30T00:00:00+00:00
2024-10-31T00:00:00+00:00\t4\t50\t2024-10-31T00:00:00+00:00
2024-11-01T00:00:00+00:00\t4\t50\t2024-11-01T00:00:00+00:00
2024-11-02T00:00:00+00:00\t2\t50\t2024-11-02T00:00:00+00:00
2024-11-03T00:00:00+00:00\t2\t50\t2024-11-03T00:00:00+00:00
2024-11-04T00:00:00+00:00\t1\t100\t2024-11-04T00:00:00+00:00
2024-11-05T00:00:00+00:00\t3\t100\t2024-11-05T00:00:00+00:00
2024-11-06T00:00:00+00:00\t2\t50\t2024-11-06T00:00:00+00:00
2024-11-07T00:00:00+00:00\t0\t\t2024-11-07T00:00:00+00:00
2024-11-08T00:00:00+00:00\t4\t25\t2024-11-08T00:00:00+00:00
2024-11-09T00:00:00+00:00\t4\t50\t2024-11-09T00:00:00+00:00
2024-11-10T00:00:00+00:00\t0\t\t2024-11-10T00:00:00+00:00
2024-11-11T00:00:00+00:00\t1\t100\t2024-11-11T00:00:00+00:00
2024-11-12T00:00:00+00:00\t2\t50\t2024-11-12T00:00:00+00:00
2024-11-13T00:00:00+00:00\t1\t100\t2024-11-13T00:00:00+00:00
2024-11-14T00:00:00+00:00\t2\t100\t2024-11-14T00:00:00+00:00
2024-11-15T00:00:00+00:00\t6\t50\t2024-11-15T00:00:00+00:00
2024-11-16T00:00:00+00:00\t8\t87.5\t2024-11-16T00:00:00+00:00
2024-11-17T00:00:00+00:00\t8\t87.5\t2024-11-17T00:00:00+00:00
2024-11-18T00:00:00+00:00\t1\t100\t2024-11-18T00:00:00+00:00
2024-11-19T00:00:00+00:00\t4\t75\t2024-11-19T00:00:00+00:00`.split('\n').slice(1);

        // 解析數據
        const parsedData = data.map(row => {
            const [date, members, retention] = row.split('\t');
            return {
                date: new Date(date).toLocaleDateString(),
                members: parseInt(members),
                retention: retention ? parseFloat(retention) : null
            };
        });

        // 填充表格
        const tbody = document.querySelector('#dataTable tbody');
        parsedData.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${row.date}</td>
                <td>${row.members}</td>
                <td>${row.retention ? row.retention.toFixed(2) : '-'}</td>
            `;
            tbody.appendChild(tr);
        });

        // 創建圖表
        const ctx = document.getElementById('retentionChart');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: parsedData.map(row => row.date),
                datasets: [
                    {
                        label: '新會員數',
                        data: parsedData.map(row => row.members),
                        borderColor: 'rgb(75, 192, 192)',
                        yAxisID: 'y',
                    },
                    {
                        label: '留存率 (%)',
                        data: parsedData.map(row => row.retention),
                        borderColor: 'rgb(255, 99, 132)',
                        yAxisID: 'y1',
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    zoom: {
                        zoom: {
                            wheel: {
                                enabled: true,
                            },
                            pinch: {
                                enabled: true
                            },
                            mode: 'x',
                            drag: {
                                enabled: true,
                                modifierKey: 'ctrl',
                            }
                        },
                        pan: {
                            enabled: true,
                            mode: 'x',
                        },
                        limits: {
                            x: {min: 'original', max: 'original'},
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: '新會員數'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: '留存率 (%)'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>