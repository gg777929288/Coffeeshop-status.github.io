<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Shop 訪客互動統計</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <style>
        .chart-container {
            min-height: 100px;
            height: 500px;
            width: 100%;
        }
        .description {
            margin: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            line-height: 1.6;
        }
        .zoom-buttons {
            margin: 10px 0;
            text-align: center;
        }
        .zoom-buttons button {
            margin: 0 5px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="description">
            <h2>每日文字互動統計</h2>
            <p>訊息數：所有成員在所有頻道發送的總訊息數量</p>
            <p>互動者人均訊息：每位互動者平均發送的訊息數量</p>
        </div>
        <div class="chart-container">
            <canvas id="visitChart"></canvas>
        </div>
        <div class="zoom-buttons">
            <button onclick="resetZoom()">重設縮放</button>
        </div>

        <div class="stats-container">
            <div class="stat-box">
                <h3>平均每日訪客</h3>
                <div id="avgVisitors" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <h3>平均互動比例</h3>
                <div id="avgCommunication" class="stat-value">0%</div>
            </div>
            <div class="stat-box">
                <h3>最高訪客數</h3>
                <div id="maxVisitors" class="stat-value">0</div>
            </div>
            <div class="stat-box">
                <h3>最高互動比例</h3>
                <div id="maxCommunication" class="stat-value">0%</div>
            </div>
        </div>
    </div>
    <script>
        const fullData = [
            ["2024-08-06T00:00:00+00:00", 82, 7.454545454545454],
            ["2024-08-07T00:00:00+00:00", 155, 9.117647058823529],
            ["2024-08-08T00:00:00+00:00", 149, 14.9],
            ["2024-08-09T00:00:00+00:00", 157, 12.076923076923077],
            ["2024-08-10T00:00:00+00:00", 78, 9.75],
            ["2024-08-11T00:00:00+00:00", 358, 27.53846153846154],
            ["2024-08-12T00:00:00+00:00", 567, 35.4375],
            ["2024-08-13T00:00:00+00:00", 208, 16],
            ["2024-08-14T00:00:00+00:00", 64, 7.111111111111111],
            ["2024-08-15T00:00:00+00:00", 486, 19.44],
            ["2024-08-16T00:00:00+00:00", 163, 10.1875],
            ["2024-08-17T00:00:00+00:00", 77, 5.923076923076923],
            ["2024-08-18T00:00:00+00:00", 149, 16.555555555555557],
            ["2024-08-19T00:00:00+00:00", 217, 12.055555555555555],
            ["2024-08-20T00:00:00+00:00", 74, 8.222222222222221],
            ["2024-08-21T00:00:00+00:00", 120, 12],
            ["2024-08-22T00:00:00+00:00", 58, 7.25],
            ["2024-08-23T00:00:00+00:00", 431, 23.944444444444443],
            ["2024-08-24T00:00:00+00:00", 131, 9.357142857142858],
            ["2024-08-25T00:00:00+00:00", 323, 14.681818181818182],
            ["2024-08-26T00:00:00+00:00", 258, 15.176470588235293],
            ["2024-08-27T00:00:00+00:00", 150, 13.636363636363637],
            ["2024-08-28T00:00:00+00:00", 448, 22.4],
            ["2024-08-29T00:00:00+00:00", 834, 39.714285714285715],
            ["2024-08-30T00:00:00+00:00", 368, 16],
            ["2024-08-31T00:00:00+00:00", 397, 20.894736842105264],
            ["2024-09-01T00:00:00+00:00", 265, 13.25],
            ["2024-09-02T00:00:00+00:00", 146, 8.11111111111111],
            ["2024-09-03T00:00:00+00:00", 145, 9.666666666666666],
            ["2024-09-04T00:00:00+00:00", 311, 20.733333333333334],
            ["2024-09-05T00:00:00+00:00", 234, 13.764705882352942],
            ["2024-09-06T00:00:00+00:00", 358, 13.76923076923077],
            ["2024-09-07T00:00:00+00:00", 227, 10.80952380952381],
            ["2024-09-08T00:00:00+00:00", 572, 22],
            ["2024-09-09T00:00:00+00:00", 355, 11.451612903225806],
            ["2024-09-10T00:00:00+00:00", 1415, 38.24324324324324],
            ["2024-09-11T00:00:00+00:00", 553, 19.75],
            ["2024-09-12T00:00:00+00:00", 1898, 51.2972972972973],
            ["2024-09-13T00:00:00+00:00", 1337, 49.51851851851852],
            ["2024-09-14T00:00:00+00:00", 448, 16],
            ["2024-09-15T00:00:00+00:00", 1077, 30.771428571428572],
            ["2024-09-16T00:00:00+00:00", 440, 25.88235294117647],
            ["2024-09-17T00:00:00+00:00", 232, 11.6],
            ["2024-09-18T00:00:00+00:00", 1219, 35.85294117647059],
            ["2024-09-19T00:00:00+00:00", 865, 28.833333333333332],
            ["2024-09-20T00:00:00+00:00", 999, 29.38235294117647],
            ["2024-09-21T00:00:00+00:00", 1880, 52.22222222222222],
            ["2024-09-22T00:00:00+00:00", 870, 24.166666666666668],
            ["2024-09-23T00:00:00+00:00", 625, 20.833333333333332],
            ["2024-09-24T00:00:00+00:00", 945, 21.477272727272727],
            ["2024-09-25T00:00:00+00:00", 3443, 71.72916666666667],
            ["2024-09-26T00:00:00+00:00", 4350, 111.53846153846153],
            ["2024-09-27T00:00:00+00:00", 899, 34.57692307692308],
            ["2024-09-28T00:00:00+00:00", 1847, 87.95238095238095],
            ["2024-09-29T00:00:00+00:00", 1015, 29.852941176470587],
            ["2024-09-30T00:00:00+00:00", 919, 21.372093023255815],
            ["2024-10-01T00:00:00+00:00", 1213, 48.52],
            ["2024-10-02T00:00:00+00:00", 3778, 58.12307692307692],
            ["2024-10-03T00:00:00+00:00", 2079, 99],
            ["2024-10-04T00:00:00+00:00", 2758, 81.11764705882354],
            ["2024-10-05T00:00:00+00:00", 2407, 70.79411764705883],
            ["2024-10-06T00:00:00+00:00", 584, 29.2],
            ["2024-10-07T00:00:00+00:00", 423, 18.391304347826086],
            ["2024-10-08T00:00:00+00:00", 627, 23.22222222222222],
            ["2024-10-09T00:00:00+00:00", 486, 20.25],
            ["2024-10-10T00:00:00+00:00", 230, 9.583333333333334],
            ["2024-10-11T00:00:00+00:00", 206, 8.24],
            ["2024-10-12T00:00:00+00:00", 258, 11.217391304347826],
            ["2024-10-13T00:00:00+00:00", 194, 10.210526315789474],
            ["2024-10-14T00:00:00+00:00", 297, 11.423076923076923],
            ["2024-10-15T00:00:00+00:00", 205, 9.318181818181818],
            ["2024-10-16T00:00:00+00:00", 342, 13.153846153846153],
            ["2024-10-17T00:00:00+00:00", 218, 9.478260869565217],
            ["2024-10-18T00:00:00+00:00", 174, 8.285714285714286],
            ["2024-10-19T00:00:00+00:00", 124, 5.904761904761905],
            ["2024-10-20T00:00:00+00:00", 112, 5.894736842105263],
            ["2024-10-21T00:00:00+00:00", 137, 9.785714285714286],
            ["2024-10-22T00:00:00+00:00", 238, 8.206896551724139],
            ["2024-10-23T00:00:00+00:00", 224, 9.73913043478261],
            ["2024-10-24T00:00:00+00:00", 238, 12.526315789473685],
            ["2024-10-25T00:00:00+00:00", 93, 7.153846153846154],
            ["2024-10-26T00:00:00+00:00", 59, 4.916666666666667],
            ["2024-10-27T00:00:00+00:00", 60, 6],
            ["2024-10-28T00:00:00+00:00", 267, 16.6875],
            ["2024-10-29T00:00:00+00:00", 221, 10.523809523809524],
            ["2024-10-30T00:00:00+00:00", 121, 7.5625],
            ["2024-10-31T00:00:00+00:00", 144, 10.285714285714286],
            ["2024-11-01T00:00:00+00:00", 98, 8.909090909090908],
            ["2024-11-02T00:00:00+00:00", 235, 13.055555555555555],
            ["2024-11-03T00:00:00+00:00", 25, 3.125],
            ["2024-11-04T00:00:00+00:00", 340, 14.782608695652174],
            ["2024-11-05T00:00:00+00:00", 225, 11.25],
            ["2024-11-06T00:00:00+00:00", 91, 4.55],
            ["2024-11-07T00:00:00+00:00", 78, 9.75],
            ["2024-11-08T00:00:00+00:00", 39, 5.571428571428571],
            ["2024-11-09T00:00:00+00:00", 34, 4.25],
            ["2024-11-10T00:00:00+00:00", 64, 7.111111111111111],
            ["2024-11-11T00:00:00+00:00", 70, 4.375],
            ["2024-11-12T00:00:00+00:00", 118, 7.375],
            ["2024-11-13T00:00:00+00:00", 108, 8.307692307692308],
            ["2024-11-14T00:00:00+00:00", 75, 8.333333333333334],
            ["2024-11-15T00:00:00+00:00", 282, 15.666666666666666],
            ["2024-11-16T00:00:00+00:00", 283, 18.866666666666667],
            ["2024-11-17T00:00:00+00:00", 131, 9.357142857142858],
            ["2024-11-18T00:00:00+00:00", 209, 12.294117647058824],
            ["2024-11-19T00:00:00+00:00", 58, 14.5],
            ["2024-11-20T00:00:00+00:00", 75, 6.25],
            ["2024-11-21T00:00:00+00:00", 331, 25.46153846153846],
            ["2024-11-22T00:00:00+00:00", 95, 8.636363636363637],
            ["2024-11-23T00:00:00+00:00", 24, 8],
            ["2024-11-24T00:00:00+00:00", 330, 15],
            ["2024-11-25T00:00:00+00:00", 389, 13.892857142857142],
            ["2024-11-26T00:00:00+00:00", 123, 6.473684210526316],
            ["2024-11-27T00:00:00+00:00", 218, 8.384615384615385],
            ["2024-11-28T00:00:00+00:00", 107, 5.944444444444445],
            ["2024-11-29T00:00:00+00:00", 198, 13.2]
            
        ];

        function initChart() {
            try {
                const data = fullData.map(row => ({
                    date: new Date(row[0]),
                    visitors: parseInt(row[1]), // 訊息數
                    communicationPct: parseFloat(row[2]) // 互動者人均訊息
                }));

                const stats = calculateStats(data);
                updateStats(stats);
                createChart(data);
            } catch (error) {
                console.error('Error:', error);
                document.querySelector('.chart-container').innerHTML = 
                    `<p style="color: red;">Error loading chart: ${error.message}</p>`;
            }
        }

        function calculateStats(data) {
            return {
                avgVisitors: Math.round(data.reduce((sum, d) => sum + d.visitors, 0) / data.length),
                avgCommunication: (data.reduce((sum, d) => sum + d.communicationPct, 0) / data.length).toFixed(2),
                maxVisitors: Math.max(...data.map(d => d.visitors)),
                maxCommunication: Math.max(...data.map(d => d.communicationPct)).toFixed(2)
            };
        }

        function updateStats(stats) {
            document.getElementById('avgVisitors').textContent = stats.avgVisitors;
            document.getElementById('avgCommunication').textContent = stats.avgCommunication + '%';
            document.getElementById('maxVisitors').textContent = stats.maxVisitors;
            document.getElementById('maxCommunication').textContent = stats.maxCommunication + '%';
        }

        function createChart(data) {
            const ctx = document.getElementById('visitChart').getContext('2d');
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => {
                        const date = d.date;
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    }),
                    datasets: [
                        {
                            label: '訊息數',
                            data: data.map(d => d.visitors),
                            borderColor: 'rgb(75, 192, 192)',
                            yAxisID: 'y',
                            tension: 0.1
                        },
                        {
                            label: '互動者人均訊息',
                            data: data.map(d => d.communicationPct),
                            borderColor: 'rgb(255, 99, 132)',
                            yAxisID: 'y1',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: '訊息數',
                                font: { size: 14 }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: '互動者人均訊息',
                                font: { size: 14 }
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '日期 (8/6-11/29)',
                                font: { size: 14 }
                            }
                        }
                    },
                    plugins: {
                        zoom: {
                            pan: {
                                enabled: true,
                                mode: 'x'
                            },
                            zoom: {
                                wheel: {
                                    enabled: true,
                                },
                                pinch: {
                                    enabled: true
                                },
                                mode: 'x',
                            }
                        },
                        legend: { position: 'top' },
                        title: {
                            display: true,
                            text: 'Coffee Shop 每日文字互動統計 (2024/8/6-11/29)',
                            font: { size: 16, weight: 'bold' }
                        }
                    }
                }
            });
        }

        function resetZoom() {
            if (window.myChart) {
                window.myChart.resetZoom();
            }
        }

        window.addEventListener('load', initChart);
    </script>
</body>
</html>